!function(){var e="undefined"!=typeof module&&module.require,n=e?module.exports:window.paredit={};e&&(n.reader=module.require("./lib/reader").reader,n.navigator=module.require("./lib/navigator").navigator,n.editor=module.require("./lib/editor").editor),n.parse=function(e,r){r=r||{};var t=r.hasOwnProperty("addSourceForLeafs")?r.addSourceForLeafs:!0,i=[],o=n.reader.readSeq(e,function(n,r,o,u,a){var l={type:n,start:o.idx,end:u.idx};return"error"===n?(l.error=r.error,i.push(l)):t&&"list"!==n&&(l.source=e.slice(l.start,l.end)),"list"===n&&(l.children=r),("list"===n||"string"===n)&&(l.open=a.open,l.close=a.close),l});return{type:"toplevel",start:0,end:o&&o.length&&o[o.length-1].end||0,errors:i,children:o}}}(),function(e){var n="undefined"!=typeof module&&module.require,r=n?module.exports:window.paredit;e(r)}(function(e){var n=e.util={merge:function(e){return arguments.length>1?n.merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e},{})},mapTree:function(e,r,t){var i=(t(e)||[]).map(function(e){return n.mapTree(e,r,t)});return r(e,i)},flatFilterTree:function(e,r,t){var i=[];return r(e)&&i.push(e),i.concat((t(e)||[]).reduce(function(e,i){return e.concat(n.flatFilterTree(i,r,t))},[]))},last:function(e){return e[e.length-1]},times:function(e,n){return new Array(e+1).join(n)},clone:function(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var n={};for(var r in e)n[r]=e[r];return n}}}),function(e){var n="undefined"!=typeof module&&module.require,r=n?module.exports:window.paredit;e(r)}(function(e){function n(e,n,f,p,g){var v=n[0];if(!v&&e&&y[e])return{input:n,context:f,pos:p,flag:w};if(!v&&!y[e])return{input:n,context:f,pos:p,flag:w};if(/\s|,/.test(v))return{input:n.slice(1),context:f,pos:x(p,v)};if(b.test(v))return l(n,f,p,g);if(";"===v)return a(n,f,p,g);if('"'===v)return t(n,f,p,g);if("\\"===v)return i(n,f,p,g);if(/[0-9]/.test(v))return u(n,f,p,g);if(I.test(v))return o(n,f,p,g);if(A.indexOf(v)>-1){if(!e){var C=c(n,f,p,g);return{input:C.input,context:C.context,pos:C.pos}}return{input:n,context:f,pos:p,flag:m}}if(S.indexOf(v)>-1){var k,O,q=h(p),F=r(v,n.slice(1),Object.freeze([]),x(p,v),g),T=F.input[0];if(T!==y[v]){var j=h(F.pos),E="Expected '"+y[v]+"'"+(T?" but got '"+T+"'":" but reached end of input"),R=s(E,q,j);k=d(g,"error",R,q,j),O=T?x(F.pos,T):F.pos}else O=T?x(F.pos,T):F.pos,k=d(g,"list",F.context,q,O,{open:v,close:y[v]});f=f.concat([k]);var L=F.input.slice(T?1:0);return{input:L,context:f,pos:O}}var q=h(p),j=x(p,v),R=s("Unexpected character: "+v,q,j);return R=d(g,"error",R,q,j),f=f.concat([R]),{input:n.slice(1),context:f,pos:j}}function r(e,r,t,i,o){for(var u;;){var a=i.row,l=i.column;u=n(e,r,t,i,o),r=u.input,t=u.context,i=u.pos;var c=u.flag===w||u.flag===m&&(e||!r.length);if(!c&&i.row<=a&&i.column<=l)throw new Error("paredit reader cannot go forward at "+g(i)+" with input "+r);if(c)break}return{input:r,context:t,pos:i}}function t(e,n,r,t){var i=!1,o=h(r),u=e[0];return r=x(r,e[0]),e=e.slice(1),f(e,r,function(e){return i||'"'!==e?(i?i=!1:"\\"===e&&(i=!0),!0):!1},function(e,r,i,a){u=u+e+r[0],a=x(a,r[0]),r=r.slice(1);var l=d(t,"string",u,o,a,{open:'"',close:'"'});return n=n.concat([l]),{pos:a,input:r,context:n}})}function i(e,n,r,t){var i=h(r),o=e.slice(0,2),u=x(r,o),a=d(t,"char",o,i,u),l=e.slice(2);return n=n.concat([a]),{pos:u,input:l,context:n}}function o(e,n,r,t){return f(e,r,function(e){return I.test(e)},function(e,r,i,o){var u=d(t,"symbol",e,i,o);return n=n.concat([u]),{pos:o,input:r,context:n}})}function u(e,n,r,t){return f(e,r,function(e){return/[0-9]/.test(e)},function(e,r,i,o){var u=d(t,"number",Number(e),i,o);return n=n.concat([u]),{pos:o,input:r,context:n}})}function a(e,n,r,t){for(var i=h(r),o="",u=e;u.length&&/^\s*;/.test(u);){var a=v(u);o+=a[0],u=a[1]}var l=x(r,o),c=d(t,"comment",o,i,l);return n=n.concat([c]),{pos:l,input:u,context:n}}function l(e,n,r,t){var i=h(r),o=e.slice(0,1),u=x(r,o),a=d(t,"special",o,i,u),l=e.slice(1);return n=n.concat([a]),{pos:u,input:l,context:n}}function c(e,n,r,t){return f(e,r,function(e){return A.indexOf(e)>-1},function(e,r,i,o){var u=s("Unexpected input: '"+e+"'",i,o),a=d(t,"error",u,i,o);return n=n.concat([a]),{pos:o,input:r,context:n}})}function s(e,n,r){return{error:e+" at line "+(r.row+1)+" column "+r.column,start:h(n),end:h(r)}}function d(e,n,r,t,i,o){return e?e(n,r,h(t),h(i),o):r}function f(e,n,r,t){for(var i=h(n),o="",u=0;u<e.length&&r(e[u]);u++)o+=e[u];return t(o,e.slice(o.length),i,x(n,o))}function p(){return{idx:0,column:0,row:0}}function h(e){return{idx:e.idx,column:e.column,row:e.row}}function g(e){return JSON.stringify(e)}function v(e){var n=e.indexOf("\n");n=n>-1?n+1:e.length;var r=e.slice(0,n),t=e.slice(n);return[r,t]}function x(e,n){if(!n)return e;e.idx+=n.length;var r=n.split("\n"),t=r.length;e.row+=t-1;var i=r[t-1].length;return e.column=t>1?i:e.column+i,e}e.reader={readSeq:function(e,n){return r(null,e,Object.freeze([]),p(),n).context},readSexp:function(e,r){return n(null,e,Object.freeze([]),p(),r).context[0]}};var m={},w={},y={"[":"]","(":")","{":"}"},S=Object.keys(y),A=S.map(function(e){return y[e]}),I=/[^\s\[\]\(\)\{\},"\\`@^#~]/,b=/[`@^#~]/}),function(e){var n="undefined"!=typeof module&&module.require,r=n?module.exports:window.paredit,t=n?module.require("./util").util:window.paredit.util;e(t,r)}(function(e,n){function r(e){return e[e.length-1]}function t(e){return e.children||[]}var i=n.navigator={forwardSexp:function(e,n){var t=r(o.containingSexpsAt(e,n,function(e){return!o.hasChildren(e)}));if(t)return t.end;var i=o.nextSexp(e,n);return i?i.end:n},backwardSexp:function(e,n){var t=r(o.containingSexpsAt(e,n,function(e){return!o.hasChildren(e)}));if(t)return t.start;var i=o.prevSexp(e,n);return i?i.start:n},forwardDownSexp:function(e,n){var r=o.nextSexp(e,n,function(e){return"list"===e.type});return r?r.children&&r.children[0]?r.children[0].start:r.start+1:n},backwardUpSexp:function(e,n){var t=o.containingSexpsAt(e,n,function(e){return"list"===e.type||"string"===e.type||"comment"===e.type});return t&&t.length?r(t).start:n},closeList:function(e,n){var t=o.containingSexpsAt(e,n),i=r(t);if(!i||"toplevel"===i.type)return n;if("string"===i.type||"comment"===i.type)return void 0;var u=t.filter(o.hasChildren);return r(u).end},sexpRange:function(e,n){return i.sexpRangeExpansion(e,n,n)},sexpRangeExpansion:function(n,i,u){if(i!==u){var a=r(o.sexpsAt(n,i,function(e){return e.start===i})),l=a&&r(o.sexpsAt(n,u,function(e){return e.end===u}));if(a&&l){var c=r(o.sexpsAt(n,i,function(e){return e.start<i&&!o.hasChildren(e)}));if(c)return[c.start,u];var s=r(o.sexpsAt(n,u,function(e){return u<e.end&&!o.hasChildren(e)}));if(s)return[i,s.end]}}var d=r(e.flatFilterTree(n,function(e){return"toplevel"===e.type?!1:i===u?e.start<=i&&u<=e.end:e.start===i?u<e.end:e.end===u?e.start<i:e.start<i&&u<e.end},t));if(!d)return null;var f=d.start===i||d.end===u;if("list"===d.type||"string"===d.type){if(f&&(i===d.start||u===d.end))return[d.start,d.end];if(d.start+1<i||u<d.end-1)return[d.start+1,d.end-1]}return[d.start,d.end]},rangeForDefun:function(e,n){var r=e.children&&e.children.filter(function(e){return e.start<=n&&n<=e.end})[0];return r?[r.start,r.end]:null}},o=n.walk={hasChildren:function(e){return"list"===e.type||"toplevel"===e.type},containingSexpsAt:function(n,r,i){return e.flatFilterTree(n,function(e){return("toplevel"===e.type||e.start<r&&r<e.end)&&(!i||i(e))},t)},sexpsAt:function(n,r,i){return e.flatFilterTree(n,function(e){return e.start<=r&&r<=e.end&&(!i||i(e))},t)},nextSexp:function(n,i,u){var a=e.flatFilterTree(n,function(e){return e.start<=i&&i<e.end&&o.hasChildren(e)},t);if(!a.length)return null;var l=a.filter(function(e){return e.start===i&&"toplevel"!==e.type})[0];if(l)return l;var c=r(a).children.filter(function(e){return i<=e.start&&(!u||!!u(e))});return c.length?c[0]:null},prevSexp:function(n,i,u){var a=e.flatFilterTree(n,function(e){return e.start<i&&i<=e.end&&o.hasChildren(e)},t);if(!a.length)return null;var l=a.filter(function(e){return e.end===i&&"toplevel"!==e.type})[0];if(l)return l;var c=r(a).children.filter(function(e){return e.end<=i&&(!u||!!u(e))});return c.length?r(c):null},stringify:function(n){return e.mapTree(n,function(r,t){return"list"===r.type||"toplevel"===r.type?"("+t.join(" ")+")":r.source?r.source:e.times(n.end-n.start,"x")},function(e){return e&&e.children||[]})},source:function(e,n){return n.source?n.source:e.slice(n.start,n.end)}}}),function(e){var n="undefined"!=typeof module&&module.require,r=n?module.exports:window.paredit,t=n?module.require("./util").util:window.paredit.util,i=n?module.require("./navigator").navigator:window.paredit.navigator,o=n?module.require("./navigator").walk:window.paredit.walk;e(i,o,t,r)}(function(e,n,r,t){function i(e,n){return e.slice(0,n).lastIndexOf("\n")+1}function o(e,n){return n-i(e,n)}function u(e,n,r){if("toplevel"===n.type)return 0;var t=s(n,r);return f(n,e)?o(e,n.start+n.open.length+1):t.length<=1||"("!==n.open?o(e,n.start+n.open.length):o(e,t[1].start)}function a(e){return e[e.length-1]}function l(e,n){return new Array(e+1).join(n)}function c(e,n){return r.mapTree(n,function(n,t){return r.merge(n,{start:n.start+e,end:n.end+e,children:t})},function(e){return e.children})}function s(e,n){return e.children.filter(function(e){return e.end<=n})}function d(e,n){return e.children.filter(function(e){return n<=e.start})}function f(e,r){if(!n.hasChildren(e)||!e.children.length)return!1;var i=e.children[0].source;return i?t.specialForms.some(function(n){return"string"==typeof n?n===i:"function"==typeof n?n(i,e.children[0]):n instanceof RegExp?n.test(i):!1}):!1}t.specialForms=["&","monitor-exit",/^case/,"try",/^reify/,"finally",/^(.*-)?loop/,/^do$/,/^let/,/^import/,"new",/^deftype/,/^let/,"fn","recur",/^set.*!$/,".","var","quote","catch","throw","monitor-enter","ns","in-ns",/^([^\/]+\/)?def/,/^if/,/^when/,/^unless/,"for",/(^|\/)with/,"testing","while","cond","condp","apply","binding","locking","proxy","reify",/^extend/,"facts"];var p=t.editor={rewrite:function(e,t,i){var o=i.length?a(i).end-t.end:t.start-t.end,u=n.containingSexpsAt(e,t.start),l=u.reduceRight(function(e,n){var t,i=n.children.indexOf(e.original);t=i>-1?n.children.slice(0,i).concat(e.nodes).concat(n.children.slice(i+1).map(c.bind(null,o))):n.children;var u=r.merge(n,{end:n.end+o,children:t});return{original:n,nodes:[u]}},{original:t,nodes:i});return l.nodes[0]},openList:function(e,r,t,i){i=i||{};var o=(i.count||1,i.open||"("),u=i.close||")";if(i.freeEdits||e.errors&&e.errors.length)return{changes:[["insert",t,o]],newIndex:t+o.length};var l=n.containingSexpsAt(e,t),c=a(l);if(c&&"comment"===c.type||"string"===c.type)return{changes:[["insert",t,o]],newIndex:t+o.length};if(!i.endIdx)return{changes:[["insert",t,o+u]],newIndex:t+o.length};var s=a(n.containingSexpsAt(e,t,n.hasChildren)),d=a(n.containingSexpsAt(e,i.endIdx,n.hasChildren));if(s!==d)return{changes:[["insert",t,o+u]],newIndex:t+o.length};var f=d.children.filter(function(e){return e.start<t&&t<e.end}),p=d.children.filter(function(e){return e.start<i.endIdx&&i.endIdx<e.end}),h=f[0]&&f[0]!==p[0]&&(p[0]||"symbol"!==f[0].type),g=p[0]&&f[0]!==p[0]&&(f[0]||"symbol"!==p[0].type),v=h?f[0].end:t,x=g?p[0].start:i.endIdx;return{changes:[["insert",x,u],["insert",v,o]],newIndex:v+o.length}},spliceSexp:function(e,r,t){var i=n.containingSexpsAt(e,t,n.hasChildren);if(!i.length)return null;var o=i.pop(),u="toplevel"===o.type,a=o.children.filter(function(e){return e.start<t&&t<e.end})[0],l=a&&"string"===a.type,c=[],s=t;return u||c.push(["remove",o.end-1,o.close.length]),l&&(c.push(["remove",a.end-1,a.close.length]),c.push(["remove",a.start,a.open.length]),s-=a.open.length),u||(c.push(["remove",o.start,o.open.length]),s-=o.open.length),{changes:c,newIndex:s}},spliceSexpKill:function(e,r,t,i){i=i||{};var o=(i.count||1,i.backward),u=n.containingSexpsAt(e,t,n.hasChildren);if(!u.length)return null;if(o)var l=s(a(u),t),c=p.killSexp(e,r,t,{count:l.length,backward:!0});else var f=d(a(u),t),c=p.killSexp(e,r,t,{count:f.length,backward:!1});var h=p.spliceSexp(e,r,t);if(!c)return h;if(!h)return c;var g=Array.prototype.slice.call(h.changes);return 2===g.length?g.splice(1,0,c.changes[0]):4===g.length&&g.splice(2,0,c.changes[0]),{changes:g,newIndex:c.newIndex-(3===g.length?1:2)}},splitSexp:function(e,r,t){var i=n.containingSexpsAt(e,t);if(!i.length)return null;var o=i.pop();if("toplevel"!==o.type){if(!n.hasChildren(o)&&"string"!==o.type)return null;var u=o.close+" "+o.open,a=t+o.close.length,l=[["insert",t,u]];return{changes:l,newIndex:a}}},killSexp:function(e,r,t,i){i=i||{};var o=i.count||1,u=i.backward,l=n.containingSexpsAt(e,t,n.hasChildren);if(!l.length)return null;var c=l.pop(),f=c.children.filter(function(e){return e.start<t&&t<e.end})[0];if(f){var p=u?f.start:t,h=u?t:f.end;return"string"===f.type&&(p+=u?f.open.length:0,h+=u?0:-f.close.length),{changes:[["remove",p,h-p]],newIndex:p}}if(f&&"string"===f.type){var p=u?f.start+f.open.length:t,h=u?t:f.end-f.close.length;return{changes:[["remove",p,h-p]],newIndex:p}}if(u){var g=s(c,t);if(!g.length)return null;var v=g.slice(-o)[0].start,x=[["remove",v,t-v]],m=v}else{var w=d(c,t);if(!w.length)return null;var m=t,x=[["remove",t,a(w.slice(0,o)).end-t]]}return{changes:x,newIndex:m}},wrapAround:function(e,r,t,i,o,u){var l=u&&u.count||1,c=n.containingSexpsAt(e,t,n.hasChildren);if(!c.length)return null;var s=a(c),d=s.children.filter(function(e){return e.start>=t}).slice(0,l),f=a(d),p=[["insert",t,i],["insert",(f?f.end:t)+i.length,o]];return{changes:p,newIndex:t+i.length}},closeAndNewline:function(e,r,t,i){i=i||")";var u=n.containingSexpsAt(e,t,function(e){return n.hasChildren(e)&&e.close===i});if(!u.length)return null;var c=a(u),s=l(o(r,c.start)," "),d="\n"+s,f=[["insert",c.end,d]];return{changes:f,newIndex:c.end+d.length}},barfSexp:function(e,r,t,i){var o=i&&i.backward,u=n.containingSexpsAt(e,t,n.hasChildren);if(!u.length)return null;var l=a(u),c=a(n.containingSexpsAt(e,t));if(c===l&&(c=null),o){var f=s(l,t);if(!f.length)return null;var p=[["insert",f[1]?f[1].start:c?c.start:t,l.open],["remove",l.start,l.open.length]]}else{var h=d(l,t);if(!h.length)return;var p=[["remove",l.end-l.close.length,l.close.length],["insert",h[h.length-2]?h[h.length-2].end:c?c.end:t,l.close]]}return{changes:p,newIndex:t}},slurpSexp:function(e,r,t,i){var o=i&&i.backward,u=i.count||1,l=n.containingSexpsAt(e,t,n.hasChildren);if(l.length<2)return null;var c=l.pop(),f=l.pop();if(o){var p=s(f,t);if(!p.length)return;var h=[["remove",c.start,c.open.length],["insert",p.slice(-u)[0].start,c.open]]}else{var g=d(f,t);if(!g.length)return;var h=[["insert",a(g.slice(0,u)).end,c.close],["remove",c.end-c.close.length,c.close.length]]}return{changes:h,newIndex:t}},transpose:function(e,r,t,i){i=i||{};var o=n.containingSexpsAt(e,t,n.hasChildren),u=a(o),l=s(u,t),c=d(u,t);if(u.children.some(function(e){return e.start<t&&t<e.end}))return null;if(!l.length||!c.length)return null;var f=a(l),p=c[0],h=r.slice(f.end,p.start)+n.source(r,f);return{changes:[["insert",p.end,h],["remove",f.start,p.start-f.start]],newIndex:t-(f.end-f.start)+(p.end-p.start)}},"delete":function(e,r,t,i){function o(e){return("string"===e.type||"list"===e.type)&&e.end-e.start===e.open.length+e.close.length}function u(e){return{changes:[["remove",e.start,e.end-e.start]],newIndex:e.start}}function l(e){return"symbol"===e.type||"comment"===e.type||"number"===e.type||"special"===e.type}i=i||{};var c=i.count||1,f=!!i.backward,p=i.endIdx;if(i.freeEdits||e.errors&&e.errors.length)return p?{changes:[["remove",t,p-t]],newIndex:t}:{changes:[["remove",f?t-c:t,c]],newIndex:f?t-c:t};var h=n.containingSexpsAt(e,t),g=h.filter(function(e){return n.hasChildren(e)}),v=a(g),x=a(h),m="number"==typeof p;if(m){var w=a(n.containingSexpsAt(e,p,n.hasChildren));if(v!==w)return null;var y=a(n.sexpsAt(v,t)),S=a(n.sexpsAt(v,p)),A=!l(y)&&y.start===t,I=!l(S)&&S.end===p;if(y===S&&(A&&!I||!A&&I))return null;if((S!==v&&!l(S)&&!I||y!==v&&!l(y)&&!A)&&y!==S)return null;if(-1===v.children.indexOf(y)&&y!==v||-1===v.children.indexOf(S)&&S!==v)return null;var b=Math.min(t,p),C=Math.max(t,p);return{changes:[["remove",b,C-b]],newIndex:b}}var k=v===x,O=k&&s(v,t),q=k&&d(v,t),F={changes:[],newIndex:t},T={changes:[["remove",f?t-c:t,c]],newIndex:f?t-c:t};if(!k&&"comment"===x.type)return T;if(O&&O.length&&f){var j=a(O);return j.end!==t||l(j)?T:o(j)||"char"===j.type?u(j):F}if(q&&q.length&&!f){var j=q[0];return j.start!==t||l(j)?T:o(j)||"char"===j.type?u(j):F}k||(v=x);var E=t===v.start+(v.open?v.open.length:0),R=t===v.end-(v.close?v.close.length:0);return v.children&&v.children.length||!(E&&f||R&&!f)?E&&f&&(k?v.children.length:v.end-v.start>1)?F:R&&!f&&(k?v.children.length:v.end-v.start>1)?F:T:u(v)},indentRange:function(e,t,o,s){var f=i(t,o),h=t.slice(s).indexOf("\n");h=h>-1?h+s:t.length;var g=t.slice(f,h).split("\n");return g.reduce(function(e,t){var i=e.idx,o=e.changes,s=e.ast,f=e.src,h=n.containingSexpsAt(s,i,n.hasChildren),g=a(h);if(!g)return{idx:i+t.length+1,newIndex:i,changes:o,ast:s,src:f};var v=t.match(/^\s*/)[0],x=u(f,g,i)-v.length,m=t.length+x;if(x>0){var w=l(x," ");o.push(["insert",i,w]),f=f.slice(0,i)+w+f.slice(i)}else 0>x&&(o.push(["remove",i,-x]),f=f.slice(0,i)+f.slice(i-x));var y=d(g,i)[0];if(y){var S=c(x,y);s=p.rewrite(s,y,[S])}else s=p.rewrite(s,g,[r.merge(g,{end:g.end+x})]);return{idx:i+m+1,newIndex:i+x,changes:o,ast:s,src:f}},{idx:f,changes:[],ast:e,src:t})}}});